<!DOCTYPE html>
<html lang="kr">
<head>
  <meta charset="UTF-8">
  <title>HOME</title>
  <link rel="stylesheet" href="../css/styles.css">
</head>
 
<body id=frame>
  <h1 style="margin-top: -10px;">알레르기 추가</h1>
  유의사항: 다중 알레르기가 있다면 같은 방식으로 여러 번 진행해주세요.
  알레르기가 없는 경우에는 추가하지 않으셔도 됩니다.<br><br>
  <form id="dataForm">
    <label for="name">이름: </label>
    <input type="text" id="name" name="name" required autocomplete="off"><br>
    <label for="allergy">알레르기: </label>
    <select id="allergy" name="allergy" required>
      <option value="없음">없음</option>
      <option value="난류">난류</option>
      <option value="우유">우유</option>
      <option value="메밀">메밀</option>
      <option value="땅콩">땅콩</option>
      <option value="대두">대두</option>
      <option value="밀">밀</option>
      <option value="고등어">고등어</option>
      <option value="게">게</option>
      <option value="새우">새우</option>
      <option value="돼지고기">돼지고기</option>
      <option value="복숭아">복숭아</option>
      <option value="토마토">토마토</option>
      <option value="아황산류">아황산류</option>
      <option value="호두">호두</option>
      <option value="닭고기">닭고기</option>
      <option value="쇠고기">쇠고기</option>
      <option value="오징어">오징어</option>
      <option value="조개류">조개류(굴, 전복, 홍합 포함)</option>
      <option value="잣">잣</option>
    </select>
    <pre><button type="submit" onclick="save()">저장</button></pre>
  </form>
 
  <h1>알레르기 삭제</h1>
  <ul id="dataList"></ul>
 
  <script>
    //데이터를 서버로부터 받아와 화면에 출력
    function fetchData() {
      fetch('http://101.101.219.171:5556/getData')
      .then(response => response.json())
      .then(data => {
        const dataList = document.getElementById('dataList');
        dataList.innerHTML = ''; // 기존 목록 초기화
 
        data.forEach(user => {
          const listItem = document.createElement('li');
          listItem.innerHTML = `
            이름: ${user.name}, 알레르기: ${user.allergy}
            <button onclick="deleteUser(${user.id})">삭제</button>`;
          dataList.appendChild(listItem); //변수 각각의 값을 dataList에 추가
        });
      })
      .catch(error => {
        console.error('오류 발생:', error);
      });
    }

    //서버 user.json에 입력한 값을 저장하는 기능
    function save() {
      const name = document.getElementById('name').value;
      const allergy = document.getElementById('allergy').value;
      const user = { name, allergy };
 
      fetch('http://101.101.219.171:5556/saveData', {
        method: 'POST', //post 메서드 (파일생성)
        headers: {
          'Content-Type': 'application/json' //json 형태의 파일을 다룸.
        },
        body: JSON.stringify(user)
      })
      .then(response => response.text()) //텍스트의 형태로
      .then(message => {
        console.log(message);
      })
      .catch(error => {
        console.error('오류 발생:', error);
      });
    };
 
    function deleteUser(id) {
      fetch(`http://101.101.219.171:5556/deleteData`, {
        method: 'DELETE',
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({id})
      })
      .then(response => response.text())
      .then(message => {
        console.log(message);
        fetchData(); // 데이터 삭제 후 데이터 다시 불러오기
      })
      .catch(error => {
        console.error('오류 발생:', error);
      });
    }
    fetchData();
  </script>
</body>
</html>
